import{w as g,k as E,g as P,a as b,r as _,p as S,t as x,l as A}from"./resolveEditInfo.B7J32-hP.js";import{b as I,bW as L,bX as T}from"./studio-component.5JEdvz6o.js";import"./index.CQkWGOce.js";import{a as u}from"./index.EmWCQ-Q3.js";function J(t){if(Array.isArray(t)){for(const e of t)if(e!=="published"&&e!=="drafts"&&!(typeof e=="string"&&e.startsWith("r")&&e!=="raw"))throw new TypeError("Invalid API perspective value, expected `published`, `drafts` or a valid release identifier string");return}switch(t){case"previewDrafts":case"drafts":case"published":case"raw":return;default:throw new TypeError("Invalid API perspective string, expected `published`, `previewDrafts` or `raw`")}}function O(t){if(J(t),Array.isArray(t))return t.includes("published")?t:[...t,"published"];switch(t){case"previewDrafts":case"drafts":return["drafts","published"];case"published":default:return["published"]}}function D(t,e){const i=O(e);function o(r){for(const n of i){let s=null;if(n.startsWith("r")&&(s=t({...r,_id:E(r._id,n)})),n==="drafts"&&(s=t({...r,_id:P(r._id)})),n==="published"&&(s=t({...r,_id:b(r._id)})),s)return{...s,_id:b(s._id),_originalId:s._id}}return null}return function(r){return o(r)}}function B(t,e,i,o,r){if(!e)return t;const n=D(i,r),s=e.documents?.map?.(n)||[];return g(JSON.parse(JSON.stringify(t)),(a,p)=>{const d=_(p,e);if(!d)return a;const{mapping:f,pathSuffix:h}=d;if(f.type!=="value"||f.source.type!=="documentValue")return a;const c=e.documents[f.source.document],m=e.paths[f.source.path];if(c){const l=S(m+h),v=x(l),w=s[f.source.document];if(!w)return a;const y=w?A(w,v,a):a;return a===y?a:o(y,{cachedDocument:w,previousValue:a,sourceDocument:c,sourcePath:l})}return a})}const F=(t,{previousValue:e})=>{if(typeof e=="string"){if(typeof t=="number")return`${t}`;if(Array.isArray(t)){if(t.length===0)return"";if(t.some(i=>typeof i=="object"&&L(i)))return T(t)}}return t};function M(t){const e=u.useMemo(()=>JSON.stringify(t||{}),[t]);return u.useMemo(()=>JSON.parse(e),[e])}function Q(t){const e=I.c(16),{refreshInterval:i}=t,o=N(),[r,n]=u.useState("hit");let s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=()=>(n("inflight"),()=>n("hit")),e[0]=s):s=e[0];const a=s;let p,d;e[1]!==i||e[2]!==r?(p=()=>{if(!i||r!=="hit")return;const v=setTimeout(()=>n("stale"),i);return()=>clearTimeout(v)},d=[i,r],e[1]=i,e[2]=r,e[3]=p,e[4]=d):(p=e[3],d=e[4]),u.useEffect(p,d);let f;e[5]!==r?(f=()=>{if(r!=="hit")return;const v=()=>n("stale");return window.addEventListener("focus",v),()=>window.removeEventListener("focus",v)},e[5]=r,e[6]=f):f=e[6];let h;e[7]!==i||e[8]!==r?(h=[i,r],e[7]=i,e[8]=r,e[9]=h):h=e[9],u.useEffect(f,h);let c,m;e[10]!==o||e[11]!==r?(c=()=>{o&&r==="hit"&&n("stale"),!o&&r==="stale"&&n("refresh")},m=[o,r],e[10]=o,e[11]=r,e[12]=c,e[13]=m):(c=e[12],m=e[13]),u.useEffect(c,m);let l;return e[14]!==r?(l=[r,a],e[14]=r,e[15]=l):l=e[15],l}function N(){const[t,e]=u.useState(!1);u.useEffect(()=>{e(navigator.onLine);const o=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",o),window.addEventListener("offline",r),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",r)}},[]);const i=u.useSyncExternalStore(R,()=>document.visibilityState,()=>"hidden");return!t||i==="hidden"}function R(t){return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)}export{B as a,Q as b,F as m,M as u};
