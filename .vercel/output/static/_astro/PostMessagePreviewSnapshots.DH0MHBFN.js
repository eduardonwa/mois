import{a as s}from"./index.EmWCQ-Q3.js";import{bd as g,w as P,$ as _,bZ as S,b_ as x,aa as E,ay as h,b$ as M}from"./studio-component.5JEdvz6o.js";import{o as $,c as k,a as R,J as y,a4 as D,a5 as U,t as j,x as F}from"./index.CQkWGOce.js";import"./client.B76MnFfN.js";function I(c){return $(function(t,a){var i=!1,o=0;t.subscribe(k(a,function(r){return(i||(i=!c(r,o++)))&&a.next(r)}))})}const O=c=>{const{comlink:t,refs:a,perspective:i}=c,o=g(),r=P(),u=s.useMemo(()=>new R,[]),m=s.useMemo(()=>u.asObservable().pipe(_(b=>S(b.map(e=>{const f={...e,_id:x(e._id)},l=i==="previewDrafts"?o.observeForPreview(f,r.get(f._type)).pipe(y(),I(n=>n.snapshot===null)):E,v={...e,_id:h(e._id)},w=o.observeForPreview(v,r.get(v._type));return D(w.pipe(U(l)),l).pipe(j(n=>!!n.snapshot),F(n=>{const p=n.snapshot;return{_id:h(p._id),title:p.title,subtitle:p.subtitle,description:p.description,imageUrl:p.imageUrl}}))}))),M(0)),[o,u,r,i]),d=s.useRef([]);return s.useEffect(()=>{const b=m.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),d.current=e});return()=>{b.unsubscribe()}},[t,m]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:d.current})),[t]),s.useEffect(()=>{u.next(a)},[a,u]),null};var V=s.memo(O);export{V as default};
